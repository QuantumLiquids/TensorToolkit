# 05 一元操作与收缩

## 一元操作概览
```cpp
#include "qlten/qlten.h"
using namespace qlten;
namespace special_qn = qlten::special_qn;

QLTensor<double, special_qn::U1QN> A; // 假设已构造初始化

double n2 = A.Get2Norm();       // 费米张量可能出现开方负
double qn2 = A.GetQuasi2Norm(); // 始终非负，稳健
bool any_nan = A.HasNan();
A *= 0.5;                       // 缩放
A.Dag();                        // 厄米共轭（翻方向+费米符号）
A.ElementWiseInv(1e-12);
A.ElementWiseSqrt();
A.RemoveTrivialIndexes();
A.Transpose({1,0,2});
A.FuseIndex(0,1);
```

## 收缩（Contract）
指针版（通用）与引用版（轴连续、有序时更高效）：
```cpp
#include "qlten/tensor_manipulation/ten_ctrct.h"
#include "qlten/tensor_manipulation/ten_ctrct_based_mat_trans.h"
using namespace qlten;
using Z2 = special_qn::Z2QN;
using DTen = QLTensor<QLTEN_Double, Z2>;

// A(l,m), B(m^†,r) -> C(l,r)
Index<Z2> l, m, r; // 省略构造
DTen A({l, m}), B({InverseIndex(m), r}), C;
Contract(&A, &B, {{1},{0}}, &C);

// 多轴一次收缩
// Contract(&A2, {1,2}, &B2, {1,0}, &C2);

// 轴连续、有序的引用版
// Contract(A, B, a_start, b_start, size, C);
```

要点：
- 需匹配 `A[a_i] == InverseIndex(B[b_i])`；结果索引顺序为 `A` 未收缩轴在前、`B` 未收缩轴在后。
- 费米符号按索引方向自动处理。

## 建议
- 一般用指针版；连续轴场景再用引用版以减少转置。
- 收缩前可 `RemoveTrivialIndexes()` 降低维度。

