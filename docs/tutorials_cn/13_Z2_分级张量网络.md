# 13 Z2 分级张量网络（实践）

本节从实践角度说明如何在库中使用带 Z2 宇称的量子数与张量，侧重“怎么做”。数学基础参见英文教程 `tutorials/13_z2_graded_tensor_network.md`。

## 量子数与索引
```cpp
#include "qlten/qlten.h"
using namespace qlten;
using special_qn::fZ2QN;

Index<fZ2QN> spin({
  QNSector<fZ2QN>(fZ2QN(0), 1), // 偶
  QNSector<fZ2QN>(fZ2QN(1), 1)  // 奇
}, TenIndexDirType::IN);
```

## 构造费米张量
```cpp
QLTensor<double, fZ2QN> A({spin, InverseIndex(spin)});
A.Random(fZ2QN::Zero());
```

## 关键操作
- `Dag()`：自动处理费米符号并翻索引方向。
- 收缩：按 IN/OUT 规则匹配，费米交换符号由底层自动结算。
- 范数：`Get2Norm()` 为分级 2-范数，`GetQuasi2Norm()` 始终非负，推荐做数值稳健化。

## 常见模式
- 构造宇称算符：对 IN 方向腿的块按奇偶乘 ±1，可用 `ActFermionPOps()`。
- 网络重排：涉及穿越时不需要手写符号，交给库的交换计数实现。

## 建议
- 索引方向保持一致性（|ket>≡IN，<bra|≡OUT）。
- 若需与玻色代码互操作，优先在高层确保方向/规则一致，减少隐性转置。

