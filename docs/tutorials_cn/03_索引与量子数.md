# 03 索引与量子数

本节介绍对称张量的核心概念：索引（Index）、量子数扇区（QNSector）、索引方向（IN/OUT），以及库内置的常用量子数类型。

## 对称张量与块稀疏
- 在多体物理中，全局/局部对称性会约束允许的态与跃迁。
- 张量据此按量子数分块存储（块稀疏），仅保留满足守恒（散度为零）的块，显著降低存储与计算开销。

## 索引、方向与量子数扇区
- `Index<QNT>` 由若干 `QNSector<QNT>` 组成；每个扇区记录一个量子数值与简并度。
- 方向 `TenIndexDirType::{IN, OUT, NDIR}`：计算散度时 OUT 计正、IN 计负；收缩时 OUT 与 IN 成对匹配。

```cpp
#include "qlten/qltensor/index.h"
#include "qlten/qltensor/qnsct.h"
#include "qlten/qltensor/special_qn/special_qn_all.h"
using namespace qlten;

// U(1)：N=0(1维), N=1(2维), N=2(1维)
Index<special_qn::U1QN> u1_out({
  QNSector<special_qn::U1QN>(special_qn::U1QN(0), 1),
  QNSector<special_qn::U1QN>(special_qn::U1QN(1), 2),
  QNSector<special_qn::U1QN>(special_qn::U1QN(2), 1)
}, TenIndexDirType::OUT);

// 反向（bra↔ket）
auto u1_in = InverseIndex(u1_out);
```

要点：
- 扇区维数 = `QNT::dim()`（通常为 1）× 简并度。
- 多索引对象的散度=按方向加减量子数。

## 内置量子数（`qlten::special_qn`）
常见类型：
- 玻色：`U1QN`、`U1U1QN`、`Z2QN`、`ZNN` 等
- 费米：`fZ2QN`（宇称）、`fU1QN`（charge mod 2）、`fZ2U1QN`、`fU1U1QN`

示例：
```cpp
// 费米宇称（Z2）：偶(0)、奇(1)
Index<special_qn::fZ2QN> parity_idx({
  QNSector<special_qn::fZ2QN>(special_qn::fZ2QN(0), 1),
  QNSector<special_qn::fZ2QN>(special_qn::fZ2QN(1), 1)
}, TenIndexDirType::OUT);

// 复合对称性 Z2 × U1（费米）
Index<special_qn::fZ2U1QN> combo_idx({
  QNSector<special_qn::fZ2U1QN>(special_qn::fZ2U1QN(0, 0), 1),
  QNSector<special_qn::fZ2U1QN>(special_qn::fZ2U1QN(1, 1), 2)
}, TenIndexDirType::OUT);
```

## 费米性的编译期判定
若 `QNT` 提供 `IsFermionParityOdd/Even()`，则被视为费米型；相关符号规则在收缩、共轭等操作中自动生效。

## 小结
- 提前设计好索引与量子数布局，有助于后续高效的收缩与分解。
- 新项目优先使用 `special_qn::*` 类型；旧的 `QNVal` 路线仅做兼容。

