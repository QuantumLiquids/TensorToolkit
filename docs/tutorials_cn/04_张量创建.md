# 04 张量创建

本节展示如何根据索引构造 `QLTensor`，进行初始化、元素访问与常见对象（如恒等/宇称算符）。

## 引入与别名
```cpp
#include "qlten/qlten.h"
using namespace qlten;
namespace special_qn = qlten::special_qn;
```

## 准备索引
```cpp
QNSector<special_qn::U1QN> s0(special_qn::U1QN(0), 2);
QNSector<special_qn::U1QN> s1(special_qn::U1QN(1), 3);
Index<special_qn::U1QN> idx({s0, s1}, TenIndexDirType::IN);
```

## 构造张量
```cpp
// 标量（rank-0）
QLTensor<double, special_qn::U1QN> scalar(IndexVec<special_qn::U1QN>{});

// 向量、矩阵、三阶张量
QLTensor<double, special_qn::U1QN> vec({idx});
QLTensor<double, special_qn::U1QN> mat({idx, InverseIndex(idx)});
QLTensor<double, special_qn::U1QN> ten3({idx, idx, InverseIndex(idx)});
```

提示：默认构造是“空”的，需要传入 `IndexVec` 才可用。

## 初始化（守恒感知）
```cpp
// 按给定散度（量子数）填充/随机化，仅对允许块生效
mat.Random(special_qn::U1QN::Zero());
mat.Fill(special_qn::U1QN::Zero(), 1.0);
scalar.Fill(special_qn::U1QN::Zero(), 2.0); // 标量散度必须为 0
```

## 元素访问
- 按密坐标（dense coordinates）：
```cpp
mat(0, 1) = 3.14; 
double v = mat(0, 1);
mat({0,0}) = 2.0;
```
- 按量子数组 + 块内坐标：
```cpp
std::vector<special_qn::U1QN> qn_sector = {special_qn::U1QN(0), special_qn::U1QN(0)};
std::vector<size_t> blk_coors = {0, 0};
mat.SetElemByQNSector(qn_sector, blk_coors, 1.0);
```

注意：逐元素赋值不会强制全局散度一致；需时请用 `Fill/Random`。

## 常见对象
```cpp
// 恒等（玻色）/宇称（费米）
auto eye = Eye<double, special_qn::U1QN>(idx);

// 手写单位矩阵
QLTensor<double, special_qn::U1QN> Id({idx, InverseIndex(idx)});
for (size_t i = 0; i < idx.dim(); ++i) Id(i, i) = 1.0;
```

## 属性与工具
```cpp
size_t rank = mat.Rank();
auto shape = mat.GetShape();
auto div = mat.Div();
double n2 = mat.Get2Norm();
double qn2 = mat.GetQuasi2Norm();
size_t nb = mat.GetQNBlkNum();
mat.Dag(); // 共轭并翻转索引方向（费米符号自动处理）
```

## 实用建议
- 先设计好索引与量子数布局，再动手编码。
- 使用 `InverseIndex(idx)` 构造 bra/ket 配对。
- 新代码优先使用 `special_qn::*`。

